// ==UserScript==
// @name          NSIS-Linker.min.user.js
// @version       0.2.6
// @date          2013-06-08
// @namespace     https://github.com/idleberg/NSIS-Linker.user.js/
// @description   Links NSIS commands found on certain webpages to the scripting reference
// @downloadURL   https://github.com/idleberg/NSIS-Linker.user.js/raw/master/NSIS-Linker.min.user.js
// @match         *://bitbucket.org/*.nsh*
// @match         *://bitbucket.org/*.nsi*
// @match         *://forums.winamp.com/*
// @match         *://github.com/*.nsh
// @match         *://github.com/*.nsi
// @match         *://nsis.sf.net/*
// @match         *://nsis.sourceforge.net/*
// @match         *://stackoverflow.com/*
// ==/UserScript==

function digits(e){return e.replace(/[^0-9]/g,"")}function alphanumerics(e){return e.replace(/[^0-9a-z]/ig,"")}function styleLink(e,t){e.style.textDecoration="underline";e.style.color="inherit"}function fixFilters(){var e,t;for(e=0;t=filters[e];++e){t.classNamePart=t.name.toLowerCase().replace(/[^0-9a-z]+/ig,"-");if(!t.regexp.global)alert("AutoLink filter "+t.name+" is not global! This will break stuff!")}}function init(){document.addEventListener("DOMNodeInserted",nodeInserted,false);setTimeout(go,50,document.body)}function nodeInserted(e){if(!moddingDOM)go(e.target)}function skipChildren(e){if(e.tagName){if(skippedElements[e.tagName.toLowerCase()]){return true}if(gmail){if(e.className=="ac")return true;if(e.className=="ilc sxs")return true}}return false}function go(e){function n(t,r){var i=0;var s;while(t&&i<100){++i;if(!r&&t.nodeType==3){if(s=runFiltersOnTextNode(t)){t=s[0];if(s[1])continue}}if(!t.firstChild)r=true;if(r&&t==e)break;else if(!r&&t.firstChild&&!skipChildren(t)){t=t.firstChild}else{if(t.nextSibling){t=t.nextSibling;r=false}else{t=t.parentNode;r=true}}}if(!t){}else if(t==e){}else{setTimeout(n,10,t,r)}}var t;for(t=e;t!=undefined;t=t.parentNode){if(skipChildren(t)){return}}e.normalize();n(e,false)}function runFiltersOnTextNode(e){var t,n,r,i,s,o,u,a,f;var l,c,h,p,d,v,m;t=e.data;f=false;o=0;for(n=0;u=filters[n];++n){r=u.regexp;if(r.test(t)){v=e.parentNode;m=e.nextSibling;r.lastIndex=0;h=null;for(i=null,s=0;o<40&&(i=r.exec(t));){a=genLink(u,i);if(a!=null&&a!=location.href){++o;c=document.createTextNode(t.substring(s,i.index));if(!f){f=true;v.removeChild(e);h=c;moddingDOM=true}v.insertBefore(c,m);l=document.createTextNode(i[0]);d=document.createElement("a");d.href=a;d.title="Look up "+u.name;d.className="autolink autolink-"+u.classNamePart;styleLink(d,u);d.appendChild(l);v.insertBefore(d,m);s=r.lastIndex}}if(f){p=document.createTextNode(t.substring(s));v.insertBefore(p,m);moddingDOM=false;return[h,true]}return[e,false]}}return null}function genLink(e,t){try{return e.href(t)}catch(n){return"data:text/plain,Error running AutoLink function for filter: "+encodeURIComponent(e.name)+"%0A%0A"+encodeURIComponent(n)}}const timeBefore=new Date;var ref_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Reference/";var func_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Functions/";const filters=[{name:"NSIS Handbook",regexp:/(?:\b)?\!(addincludedir|addplugindir|appendfile|cd|define|delfile|echo|else|endif|error|execute|finalize|getdllversionsystem|ifdef|ifmacrodef|ifmacrondef|ifndef|if|include|insertmacro|macroend|macro|packhdr|searchparse|searchreplace|tempfile|undef|verbose|warnings)\b/g,href:function(e){return ref_url+e[0]+".md"}},{name:"NSIS Handbook",regexp:/(?:\b)?(onGUIEnd|onGUIInit|onInit|onInstFailed|onInstSuccess|onMouseOverSection|onRebootFailed|onSelChange|onUserAbort|onVerifyInstDir|un\.onGUIEnd|un\.onGUIInit|un\.onInit|un\.onRebootFailed|un\.onSelChange|un\.onUninstFailed|un\.onUninstSuccess|un\.onUserAbort)\b/g,href:function(e){return func_url+e[0]+".md"}},{name:"NSIS Wiki",regexp:/\b([a-zA-Z0-9_]+)::([a-zA-Z0-9_]+)\b/g,href:function(e){return"http://nsis.sourceforge.net/mediawiki/index.php?title=Special:Search&search="+e[1]+"+plugin"}},{name:"NSIS Handbook",regexp:/\b(Abort|AddBrandingImage|AddSize|AllowRootDirInstall|AllowSkipFiles|AutoCloseWindow|BGFont|BGGradient|BrandingText|BringToFront|Call|CallInstDLL|Caption|ChangeUI|CheckBitmap|ClearErrors|CompletedText|ComponentText|CopyFiles|CRCCheck|CreateDirectory|CreateFont|CreateShortCut|Delete|DeleteINISec|DeleteINIStr|DeleteRegKey|DeleteRegValue|DetailPrint|DetailsButtonText|DirText|DirVar|DirVerify|EnableWindow|EnumRegKey|EnumRegValue|Exch|Exec|ExecShell|ExecWait|ExpandEnvStrings|File|FileBufSize|FileClose|FileErrorText|FileOpen|FileRead|FileReadByte|FileReadUTF16LE|FileReadWord|FileSeek|FileWrite|FileWriteByte|FileWriteUTF16LE|FileWriteWord|FindClose|FindFirst|FindNext|FindWindow|FlushINI|GetCurInstType|GetCurrentAddress|GetDlgItem|GetDLLVersion|GetDLLVersionLocal|GetErrorLevel|GetFileTime|GetFileTimeLocal|GetFullPathName|GetFunctionAddress|GetInstDirError|GetLabelAddress|GetTempFileName|Goto|HideWindow|Icon|IfAbort|IfErrors|IfFileExists|IfRebootFlag|IfSilent|InitPluginsDir|InstallButtonText|InstallColors|InstallDir|InstallDirRegKey|InstProgressFlags|InstType|InstTypeGetText|InstTypeSetText|IntCmp|IntCmpU|IntFmt|IntOp|IsWindow|LangString|LicenseBkColor|LicenseData|LicenseForceSelection|LicenseLangString|LicenseText|LoadLanguageFile|LockWindow|LogSet|LogText|ManifestDPIAware|ManifestSupportedOS|MessageBox|MiscButtonText|Name|Nop|OutFile|Page|Page|PageCallbacks|Pop|Push|Quit|ReadEnvStr|ReadINIStr|ReadRegDWORD|ReadRegStr|Reboot|RegDLL|Rename|RequestExecutionLevel|ReserveFile|Return|RMDir|SearchPath|SectionGetFlags|SectionGetInstTypes|SectionGetSize|SectionGetText|SectionIn|SectionSetFlags|SectionSetInstTypes|SectionSetSize|SectionSetText|SendMessage|SetAutoClose|SetBrandingImage|SetCompress|SetCompressor|SetCompressorDictSize|SetCtlColors|SetCurInstType|SetDatablockOptimize|SetDateSave|SetDetailsPrint|SetDetailsView|SetErrorLevel|SetErrors|SetFileAttributes|SetFont|SetOutPath|SetOverwrite|SetPluginUnload|SetRebootFlag|SetRegView|SetShellVarContext|SetSilent|ShowInstDetails|ShowUninstDetails|ShowWindow|SilentInstall|SilentUnInstall|Sleep|SpaceTexts|StrCmp|StrCmpS|StrCpy|StrLen|SubCaption|Unicode|UninstallButtonText|UninstallCaption|UninstallIcon|UninstallSubCaption|UninstallText|UninstPage|UninstPage|UnRegDLL|Var|VIAddVersionKey|VIFileVersion|VIProductVersion|WindowIcon|WriteINIStr|WriteRegBin|WriteRegDWORD|WriteRegExpandStr|WriteRegStr|WriteUninstaller|XPStyle)\b/g,href:function(e){return ref_url+e[1]+".md"}},{name:"NSIS Handbook",regexp:/\b(SectionGroupEnd|SectionGroup|FunctionEnd|Function|SectionEnd|Section|SubSectionEnd|SubSection|PageExEnd|PageEx)\b/g,href:function(e){return ref_url+e[1]+".md"}}];fixFilters();var moddingDOM=false;window.addEventListener("load",init,false);const skippedElements={a:true,noscript:true,head:true,script:true,style:true,textarea:true,label:true,select:true,button:true,h1:true,h2:true,h3:true,h4:true};const gmail=location.host=="gmail.google.com"