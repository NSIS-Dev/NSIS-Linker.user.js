// ==UserScript==
// @name          NSIS-Linker.min.user.js
// @version       0.2.7
// @date          2013-06-1
// @namespace     https://github.com/idleberg/NSIS-Linker.user.js/
// @description   Links NSIS commands found on certain webpages to the scripting reference
// @downloadURL   https://github.com/idleberg/NSIS-Linker.user.js/raw/master/NSIS-Linker.min.user.js
// @match         *://bitbucket.org/*.nsh*
// @match         *://bitbucket.org/*.nsi*
// @match         *://forums.winamp.com/*
// @match         *://github.com/*.nsh
// @match         *://github.com/*.nsi
// @match         *://nsis.sf.net/*
// @match         *://nsis.sourceforge.net/*
// @match         *://stackoverflow.com/*
// ==/UserScript==

const timeBefore=new Date();var ref_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Reference/";var functions_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Functions/";var logiclib_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Includes/LogicLib/";var winver_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Includes/WinVer/";var filefunc_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Includes/FileFunc/";var textfunc_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Includes/TextFunc/";var wordfunc_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Includes/WordFunc/";var memento_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Includes/Memento/";var x64_url="https://github.com/NSIS-Handbook/Documentation/blob/master/Includes/x64x/";const filters=[{name:"NSIS Handbook",regexp:/(?:\b)?\!(addincludedir|addplugindir|appendfile|cd|define|delfile|echo|else|endif|error|execute|finalize|getdllversionsystem|ifdef|ifmacrodef|ifmacrondef|ifndef|if|include|insertmacro|macroend|macro|packhdr|searchparse|searchreplace|tempfile|undef|verbose|warnings)\b/g,href:function(a){return ref_url+a[0]+".md"}},{name:"NSIS Handbook",regexp:/(?:\b)?(\.onGUIEnd|\.onGUIInit|\.onInit|\.onInstFailed|\.onInstSuccess|\.onMouseOverSection|\.onRebootFailed|\.onSelChange|\.onUserAbort|\.onVerifyInstDir|un\.onGUIEnd|un\.onGUIInit|un\.onInit|un\.onRebootFailed|un\.onSelChange|un\.onUninstFailed|un\.onUninstSuccess|un\.onUserAbort)\b/g,href:function(a){return functions_url+a[0]+".md"}},{name:"NSIS Wiki",regexp:/\b([a-zA-Z0-9_]+)::([a-zA-Z0-9_]+)\b/g,href:function(a){return"http://nsis.sourceforge.net/mediawiki/index.php?title=Special:Search&search="+a[1]+"+plugin"}},{name:"NSIS Handbook",regexp:/\b(Abort|AddBrandingImage|AddSize|AllowRootDirInstall|AllowSkipFiles|AutoCloseWindow|BGFont|BGGradient|BrandingText|BringToFront|Call|CallInstDLL|Caption|ChangeUI|CheckBitmap|ClearErrors|CompletedText|ComponentText|CopyFiles|CRCCheck|CreateDirectory|CreateFont|CreateShortCut|Delete|DeleteINISec|DeleteINIStr|DeleteRegKey|DeleteRegValue|DetailPrint|DetailsButtonText|DirText|DirVar|DirVerify|EnableWindow|EnumRegKey|EnumRegValue|Exch|Exec|ExecShell|ExecWait|ExpandEnvStrings|File|FileBufSize|FileClose|FileErrorText|FileOpen|FileRead|FileReadByte|FileReadUTF16LE|FileReadWord|FileSeek|FileWrite|FileWriteByte|FileWriteUTF16LE|FileWriteWord|FindClose|FindFirst|FindNext|FindWindow|FlushINI|GetCurInstType|GetCurrentAddress|GetDlgItem|GetDLLVersion|GetDLLVersionLocal|GetErrorLevel|GetFileTime|GetFileTimeLocal|GetFullPathName|GetFunctionAddress|GetInstDirError|GetLabelAddress|GetTempFileName|Goto|HideWindow|Icon|IfAbort|IfErrors|IfFileExists|IfRebootFlag|IfSilent|InitPluginsDir|InstallButtonText|InstallColors|InstallDir|InstallDirRegKey|InstProgressFlags|InstType|InstTypeGetText|InstTypeSetText|IntCmp|IntCmpU|IntFmt|IntOp|IsWindow|LangString|LicenseBkColor|LicenseData|LicenseForceSelection|LicenseLangString|LicenseText|LoadLanguageFile|LockWindow|LogSet|LogText|ManifestDPIAware|ManifestSupportedOS|MessageBox|MiscButtonText|Name|Nop|OutFile|Page|Page|PageCallbacks|Pop|Push|Quit|ReadEnvStr|ReadINIStr|ReadRegDWORD|ReadRegStr|Reboot|RegDLL|Rename|RequestExecutionLevel|ReserveFile|Return|RMDir|SearchPath|SectionGetFlags|SectionGetInstTypes|SectionGetSize|SectionGetText|SectionIn|SectionSetFlags|SectionSetInstTypes|SectionSetSize|SectionSetText|SendMessage|SetAutoClose|SetBrandingImage|SetCompress|SetCompressor|SetCompressorDictSize|SetCtlColors|SetCurInstType|SetDatablockOptimize|SetDateSave|SetDetailsPrint|SetDetailsView|SetErrorLevel|SetErrors|SetFileAttributes|SetFont|SetOutPath|SetOverwrite|SetPluginUnload|SetRebootFlag|SetRegView|SetShellVarContext|SetSilent|ShowInstDetails|ShowUninstDetails|ShowWindow|SilentInstall|SilentUnInstall|Sleep|SpaceTexts|StrCmp|StrCmpS|StrCpy|StrLen|SubCaption|Unicode|UninstallButtonText|UninstallCaption|UninstallIcon|UninstallSubCaption|UninstallText|UninstPage|UninstPage|UnRegDLL|Var|VIAddVersionKey|VIFileVersion|VIProductVersion|WindowIcon|WriteINIStr|WriteRegBin|WriteRegDWORD|WriteRegExpandStr|WriteRegStr|WriteUninstaller|XPStyle)\b/g,href:function(a){return ref_url+a[1]+".md"}},{name:"NSIS Handbook",regexp:/\b(SectionGroupEnd|SectionGroup|FunctionEnd|Function|SectionEnd|Section|SubSectionEnd|SubSection|PageExEnd|PageEx)\b/g,href:function(a){return ref_url+a[1]+".md"}},{name:"NSIS Handbook",regexp:/(?:\$\{)(Abort|AndIf|AndIfNot|Case|Cmd|Do|LoopUntil|DoUntil|Else|ElseIf|ElseIfNot|ElseUnless|EndWhile|Errors|ExitDo|ExitWhile|FileExists|For|ForEach|If|IfCmd|IfNot|IfThen|IfThenNot|Loop|Next|OrIfNot|RebootFlag|SectionIsBold|SectionIsExpanded|SectionIsPartiallySelected|SectionIsReadOnly|SectionIsSectionGroup|SectionIsSectionGroupEnd|SectionIsSelected|Select|Silent|Switch|Unless|While)(?:\})/g,href:function(a){return logiclib_url+a[1]+".md"}},{name:"NSIS Handbook",regexp:/(?:\$\{)(AtLeastServicePack|AtLeastWin2000|AtLeastWin2003|AtLeastWin2008|AtLeastWin2008R2|AtLeastWin2012|AtLeastWin7|AtLeastWin8|AtLeastWin95|AtLeastWin98|AtLeastWinME|AtLeastWinNT4|AtLeastWinVista|AtLeastWinXP|AtMostServicePack|AtMostWin2000|AtMostWin2003|AtMostWin2008|AtMostWin2008R2|AtMostWin2012|AtMostWin7|AtMostWin8|AtMostWin95|AtMostWin98|AtMostWinME|AtMostWinNT4|AtMostWinVista|AtMostWinXP|IsNT|IsServer|IsServicePack|IsWin2000|IsWin2003|IsWin2008|IsWin2008R2|IsWin2012|IsWin7|IsWin8|IsWin95|IsWin98|IsWinME|IsWinNT4|IsWinVista|IsWinXP)(?:\})/g,href:function(a){return winver_url+a[1]+".md"}},{name:"NSIS Handbook",regexp:/(?:\$\{)(BannerTrimPath|DirState|DriveSpace|GetBaseName|GetDrives|GetExeName|GetExePath|GetFileAttributes|GetFileExt|GetFileName|GetFileVersion|GetOptions|GetOptionsS|GetParameters|GetParent|GetRoot|GetSize|GetTime|Locate|RefreshShellIcons)(?:\})/g,href:function(a){return filefunc_url+a[1]+".md"}},{name:"NSIS Handbook",regexp:/(?:\$\{)(ConfigRead|ConfigReadS|ConfigWrite|ConfigWriteS|FileJoin|FileReadFromEnd|FileRecode|LineFind|LineRead|LineSum|TextCompare|TextCompareS|TrimNewLines)(?:\})/g,href:function(a){return textfunc_url+a[1]+".md"}},{name:"NSIS Handbook",regexp:/(?:\$\{)(StrFilter|StrFilterS|VersionCompare|WordAdd|WordAddS|WordFind|WordFind2x|WordFind2xS|WordFind3x|WordFind3xS|WordFindS|WordInsert|WordInsertS|WordReplace|WordReplaceS)(?:\})/g,href:function(a){return wordfunc_url+a[1]+".md"}},{name:"NSIS Handbook",regexp:/(?:\$\{)(DisableX64FSRedirection|EnableX64FSRedirection|RunningX64)(?:\})/g,href:function(a){return x64_url+a[1]+".md"}},{name:"NSIS Handbook",regexp:/(?:\$\{)(MementoSection|MementoSectionEnd|MementoSectionRestore|MementoSectionSave|MementoUnselectedSection)(?:\})/g,href:function(a){return memento_url+a[1]+".md"}}];function digits(a){return a.replace(/[^0-9]/g,"")}function alphanumerics(a){return a.replace(/[^0-9a-z]/ig,"")}function styleLink(b,c){b.style.textDecoration="underline";b.style.color="inherit"}function fixFilters(){var a,b;for(a=0;b=filters[a];++a){b.classNamePart=b.name.toLowerCase().replace(/[^0-9a-z]+/ig,"-");if(!b.regexp.global){alert("AutoLink filter "+b.name+" is not global! This will break stuff!")}}}fixFilters();var moddingDOM=false;window.addEventListener("load",init,false);function init(){document.addEventListener("DOMNodeInserted",nodeInserted,false);setTimeout(go,50,document.body)}function nodeInserted(a){if(!moddingDOM){go(a.target)}}const skippedElements={a:true,noscript:true,head:true,script:true,style:true,textarea:true,label:true,select:true,button:true,h1:true,h2:true,h3:true,h4:true};const gmail=(location.host=="gmail.google.com");function skipChildren(a){if(a.tagName){if(skippedElements[a.tagName.toLowerCase()]){return true}if(gmail){if(a.className=="ac"){return true}if(a.className=="ilc sxs"){return true}}}return false}function go(c){var b;for(b=c;b!=undefined;b=b.parentNode){if(skipChildren(b)){return}}c.normalize();function a(g,e){var d=0;var f;while(g&&d<100){++d;if(!e&&g.nodeType==3){if((f=runFiltersOnTextNode(g))){g=f[0];if(f[1]){continue}}}if(!g.firstChild){e=true}if(e&&g==c){break}else{if(!e&&g.firstChild&&!skipChildren(g)){g=g.firstChild}else{if(g.nextSibling){g=g.nextSibling;e=false}else{g=g.parentNode;e=true}}}}if(!g){}else{if(g==c){}else{setTimeout(a,10,g,e)}}}a(c,false)}function runFiltersOnTextNode(f){var b,l,o,m,d,h,e,c,t;var s,g,n,r,p,q,i;b=f.data;t=false;h=0;for(l=0;e=filters[l];++l){o=e.regexp;if(o.test(b)){q=f.parentNode;i=f.nextSibling;o.lastIndex=0;n=null;for(m=null,d=0;h<40&&(m=o.exec(b));){c=genLink(e,m);if(c!=null&&c!=location.href){++h;g=document.createTextNode(b.substring(d,m.index));if(!t){t=true;q.removeChild(f);n=g;moddingDOM=true}q.insertBefore(g,i);s=document.createTextNode(m[0]);p=document.createElement("a");p.href=c;p.title="Look up "+e.name;p.className="autolink autolink-"+e.classNamePart;styleLink(p,e);p.appendChild(s);q.insertBefore(p,i);d=o.lastIndex}}if(t){r=document.createTextNode(b.substring(d));q.insertBefore(r,i);moddingDOM=false;return[n,true]}return[f,false]}}return null}function genLink(b,a){try{return b.href(a)}catch(c){return"data:text/plain,Error running AutoLink function for filter: "+encodeURIComponent(b.name)+"%0A%0A"+encodeURIComponent(c)}};